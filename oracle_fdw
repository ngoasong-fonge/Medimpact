export LD_LIBRARY_PATH=/opt/app/oracle/product/instantclient_19_21
export LIBPATH=/opt/app/oracle/product/instantclient_19_21
export ORACLE_HOME=/opt/app/oracle/product/instantclient_19_21
export PATH=$ORACLE_HOME:$PATH
sqlplus


create extension oracle_fdw schema dmeapps;
CREATE SERVER ora_sv FOREIGN DATA WRAPPER oracle_fdw
OPTIONS (dbserver 'dp1medex2-scan1:2025/RTESTPDB');

GRANT USAGE ON FOREIGN SERVER ora_sv TO postgres;

CREATE USER MAPPING FOR postgres SERVER ora_sv
OPTIONS ( USER 'pglink', PASSWORD 't3str0n');

CREATE FOREIGN TABLE dmeapps.departments_tst
(
  DEPARTMENT_ID    NUMERIC(10,0)                   NOT NULL,
  DEPARTMENT_NAME  CHARACTER VARYING(30)         NOT NULL,
  MANAGER_ID       NUMERIC(6,0),
  LOCATION_ID      NUMERIC(4,0)
) SERVER ora_sv OPTIONS (SCHEMA 'PSAMY' , TABLE 'DEPARTMENTS_TST');


citus=# select * from dmeapps.departments_tst limit 2;
ERROR:  Oracle table "PSAMY"."DEPARTMENTS_TST" for foreign table "departments_tst" does not exist or does not allow read access
DETAIL:  ORA-00942: table or view does not exist
HINT:  Oracle table names are case sensitive (normally all uppercase).


citus=# \d dmeapps.departments_tst
                        Foreign table "dmeapps.departments_tst"
     Column      |         Type          | Collation | Nullable | Default | FDW options
-----------------+-----------------------+-----------+----------+---------+-------------
 department_id   | numeric(10,0)         |           | not null |         |
 department_name | character varying(30) |           | not null |         |
 manager_id      | numeric(6,0)          |           |          |         |
 location_id     | numeric(4,0)          |           |          |         |
Server: ora_sv
FDW options: (schema 'PSAMY', "table" 'DEPARTMENTS_TST')

citus=# \det+
               List of foreign tables
 Schema | Table | Server | FDW options | Description
--------+-------+--------+-------------+-------------
(0 rows)
