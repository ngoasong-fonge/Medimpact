[databases]
db1 = host=1.1.1.1 port=5432 dbname=db1 user=db1_user
db2 = host=1.1.1.1 port=5432 dbname=db2 user=db2_user

[pgbouncer]
listen_addr = 1.1.1.1
listen_port = 3333
auth_type = md5
auth_file = /etc/pgbouncer/userlist.txt
admin_users = admin_user
pool_mode = transaction
max_client_conn = 1000
default_pool_size = 20
logfile = /var/log/pgbouncer/pgbouncer.log
pidfile = /var/log/pgbouncer/pgbouncer.pid
unix_socket_dir = /tmp
ignore_startup_parameters = extra_float_digits


ERROR:  value too long for type character varying(500)
CONTEXT:  COPY salesforce_a_g_detail, line 377, column corrective_and_preventative_action__c: "Determine whether we can include tracking on all plan materials moving fwd so we can confirm that ma..."

ALTER TABLE salesforce_a_g_detail ALTER COLUMN corrective_and_preventative_action__c TYPE character varying(1000);

Modify the Table Schema:
Alter the column to increase its length to accommodate the longer values.
Preprocess the CSV File:
Truncate the data in the CSV file to fit within the existing column length constraints.

https://get.enterprisedb.com/docs/EDB_Failover_Manager_Guide_v3.5.pdf










Prerequisites
•	Ensure that the standby server is fully synchronized with the primary server.
•	Ensure that you have proper backup and recovery plans in place before proceeding with the switchover.
Step-by-Step Procedure for Manual Switchover
1.	Check Replication Status: Ensure that the standby server is up-to-date with the primary server.
On the primary server:
sql
Copy code
SELECT * FROM pg_stat_replication;
2.	Promote Standby to Primary: On the standby server, promote it to primary using the pg_ctl command.
sh
Copy code
pg_ctl promote -D /path/to/standby/data_directory
Alternatively, you can create a trigger file if it’s configured in recovery.conf:
sh
Copy code
touch /path/to/standby/trigger_file
3.	Reconfigure Old Primary as Standby:
a. Stop the Old Primary Server:
sh
Copy code
pg_ctl stop -D /path/to/primary/data_directory -m fast
b. Remove Recovery Configuration (if any): Remove any old recovery configurations that might be present.
sh
Copy code
rm /path/to/primary/data_directory/recovery.conf
c. Create Recovery Configuration: Create a new recovery.conf file on the old primary server to configure it as a standby.
sh
Copy code
cat <<EOF > /path/to/primary/data_directory/recovery.conf
standby_mode = 'on'
primary_conninfo = 'host=new_primary_host port=5432 user=replication_user password=replication_password'
trigger_file = '/path/to/primary/trigger_file'
EOF
d. Start the Old Primary as Standby:
sh
Copy code
pg_ctl start -D /path/to/primary/data_directory
Example Configuration
Primary Server (Old):
•	Data Directory: /var/lib/postgresql/12/main
•	Host: old_primary_host
Standby Server (New Primary):
•	Data Directory: /var/lib/postgresql/12/main
•	Host: new_primary_host
Primary Conninfo (used in recovery.conf):
sh
Copy code
primary_conninfo = 'host=new_primary_host port=5432 user=replication_user password=replication_password'
Step-by-Step Commands
1. Promote the Standby Server:
sh
Copy code
# On the standby server
pg_ctl promote -D /var/lib/postgresql/12/main
2. Stop the Old Primary Server:
sh
Copy code
# On the old primary server
pg_ctl stop -D /var/lib/postgresql/12/main -m fast
3. Reconfigure the Old Primary as Standby:
sh
Copy code
# On the old primary server
rm /var/lib/postgresql/12/main/recovery.conf

cat <<EOF > /var/lib/postgresql/12/main/recovery.conf
standby_mode = 'on'
primary_conninfo = 'host=new_primary_host port=5432 user=replication_user password=replication_password'
trigger_file = '/var/lib/postgresql/12/main/trigger_file'
EOF
4. Start the Old Primary as Standby:
sh
Copy code
# On the old primary server
pg_ctl start -D /var/lib/postgresql/12/main
Verification
On the New Primary:
Check that the new primary is running and accepting connections:
sh
Copy code
psql -h new_primary_host -U your_user -d your_database -c "SELECT pg_is_in_recovery();"
On the Old Primary (now Standby):
Check the replication status to ensure it is now a standby:
sh
Copy code
psql -h old_primary_host -U your_user -d your_database -c "SELECT * FROM pg_stat_wal_receiver;"
