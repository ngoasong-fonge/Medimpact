#!/bin/bash

# Source the environment file
source /opt/app/localhome/svcpostgres/pg_env.sh

# Specify backup and log file locations
backup_location="/opt/backup"
log_location="/opt/backup/backup_restore_log.txt"

# Record the start time
start_time=$(date +"%Y-%m-%d %H:%M:%S")

# Backup the schema to /opt/backup
pg_dump -h localhost -U $PGUSER -d citus -n your_schema -F c -f "$backup_location/your_schema_backup.dump"

# Restore the schema within the same database
pg_restore -h localhost -U $PGUSER -d citus -F c -n new_schema "$backup_location/your_schema_backup.dump"

# Record the completion time
end_time=$(date +"%Y-%m-%d %H:%M:%S")

# Output the start and completion times to a log file
echo "Start Time: $start_time" > "$log_location"
echo "Completion Time: $end_time" >> "$log_location"

# Display the log file path
echo "Backup and restore completed. Log file: $log_location"
